import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

st.set_page_config(page_title="FA Executive Dashboard", layout="wide")

# ------------------------------
# üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
# ------------------------------
data = [
    {
        "‡∏•‡∏≥‡∏î‡∏±‡∏ö": 1,
        "‡∏ä‡∏∑‡πà‡∏≠ FA": "‡πÅ‡∏≠‡πä‡∏ö‡πÇ‡∏ã‡∏•‡∏π‡∏ó ‡πÅ‡∏≠‡πá‡∏î‡πÑ‡∏ß‡πÄ‡∏≠‡∏£‡∏µ‡πà ‡∏ö‡∏à‡∏Å.",
        "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á": "P",
        "‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "",
        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£",
        "‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•": "‡∏ß‡∏¥‡∏†‡∏≤‡∏ß‡∏µ ‡∏â‡∏±‡∏ï‡∏£‡∏®‡∏¥‡∏£‡∏¥ ‡∏ô.‡∏™.",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö": "2018-01-09",
        "‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠": "‡∏à‡∏ó. /2562",
        "‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà": "2019-01-09",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "2019-01-01",
        "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥": "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î"
    },
    {
        "‡∏•‡∏≥‡∏î‡∏±‡∏ö": 2,
        "‡∏ä‡∏∑‡πà‡∏≠ FA": "‡∏Ñ‡∏±‡∏ô‡∏ó‡∏£‡∏µ‡πà ‡∏Å‡∏£‡∏∏‡πä‡∏õ ‡∏ö‡∏•. ‡∏ö‡∏°‡∏à.",
        "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á": "",
        "‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "P",
        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": "‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ø ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å",
        "‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•": "‡∏≠‡∏†‡∏¥‡∏ä‡∏≤‡∏ï ‡∏®‡∏£‡∏µ‡∏≠‡∏°‡∏£‡∏ò‡∏£‡∏£‡∏° ‡∏ô‡∏≤‡∏¢",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö": "2019-01-09",
        "‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠": "‡∏à‡∏ó. /2562",
        "‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà": "2019-01-09",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "2019-01-01",
        "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥": "___"
    },
    {
        "‡∏•‡∏≥‡∏î‡∏±‡∏ö": 3,
        "‡∏ä‡∏∑‡πà‡∏≠ FA": "‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï ‡∏ö‡∏•. ‡∏ö‡∏°‡∏à.",
        "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á": "P",
        "‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "",
        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ø ‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà",
        "‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•": "‡∏ä‡∏•‡∏Å‡∏§‡∏ï ‡πÑ‡∏û‡∏£‡πÑ‡∏û‡∏®‡∏≤‡∏•‡∏Å‡∏¥‡∏à ‡∏ô‡∏≤‡∏¢, ‡∏ò‡∏µ‡∏£‡∏û‡∏• ‡∏™‡∏≤‡∏¢‡πÅ‡∏Å‡πâ‡∏ß ‡∏ô‡∏≤‡∏¢, ‡∏≠‡∏£‡∏û‡∏£‡∏£‡∏ì ‡∏´‡∏≤‡∏ç‡∏®‡∏¥‡∏•‡∏õ‡πå‡∏û‡∏á‡∏®‡πå ‡∏ô.‡∏™.",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö": "2019-01-11",
        "‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠": "‡∏à‡∏ó. /2562",
        "‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà": "2019-01-11",
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á": "2019-01-02",
        "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥": "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î"
    }
]

df = pd.DataFrame(data)

# ------------------------------
# üîπ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
# ------------------------------
df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö"] = pd.to_datetime(df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö"])
df["‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"] = pd.to_datetime(df["‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"])
df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"] = pd.to_datetime(df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"])

# ------------------------------
# üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á Column ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
# ------------------------------
df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"] = np.select(
    [
        (df["‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á"] == "P") & (df["‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"] == "P"),
        (df["‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á"] == "P"),
        (df["‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"] == "P")
    ],
    ["‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á", "‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á", "‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"],
    default="‡πÑ‡∏°‡πà‡∏°‡∏µ"
)

df["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•"] = df["‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•"].apply(lambda x: len(str(x).split(",")))
df["‡∏õ‡∏µ"] = df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"].dt.year
df["‡∏õ‡∏µ-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"] = df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"].dt.to_period("M").astype(str)
df["‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö"] = (df["‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"] - df["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö"]).dt.days
df["‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î"] = df["‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"].str.contains("‡πÑ‡∏°‡πà‡∏û‡∏ö").apply(lambda x: 0 if x else 1)

# ------------------------------
# üîπ Sidebar Filters
# ------------------------------
st.sidebar.header("üîç ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
years = df["‡∏õ‡∏µ"].dropna().unique().tolist()
selected_years = st.sidebar.multiselect("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ", options=years, default=years)
filtered_df = df[df["‡∏õ‡∏µ"].isin(selected_years)]

# ------------------------------
# üîπ KPI Summary
# ------------------------------
st.title("üìä FA Executive Summary Dashboard")

col1, col2, col3, col4 = st.columns(4)
col1.metric("FA ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", filtered_df["‡∏ä‡∏∑‡πà‡∏≠ FA"].nunique())
col2.metric("‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á", filtered_df["‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á"].eq("P").sum())
col3.metric("‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á", filtered_df["‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"].eq("P").sum())
col4.metric("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", filtered_df["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•"].sum())

col5, col6 = st.columns(2)
col5.metric("‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î", filtered_df["‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î"].sum())
col6.metric("‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏±‡∏ô)", round(filtered_df["‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö"].mean(), 2))

st.markdown("---")

# ------------------------------
# üîπ Pie Chart: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
# ------------------------------
st.subheader("ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á")
change_type = filtered_df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"].value_counts().reset_index()
change_type.columns = ["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"]
fig1 = px.pie(change_type, names="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á", values="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", title="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á")
st.plotly_chart(fig1, use_container_width=True)

# ------------------------------
# üîπ Bar Chart: ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
# ------------------------------
st.subheader("üìÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô")
monthly = filtered_df.groupby(["‡∏õ‡∏µ-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"]).size().reset_index(name="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô")
fig2 = px.bar(monthly, x="‡∏õ‡∏µ-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", y="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", color="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á", barmode="stack",
              title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô")
st.plotly_chart(fig2, use_container_width=True)

# ------------------------------
# üîπ Boxplot: ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
# ------------------------------
st.subheader("‚è≥ ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏ß‡∏±‡∏ô)")
fig3 = px.box(filtered_df, y="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö", points="all", title="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö")
st.plotly_chart(fig3, use_container_width=True)

# ------------------------------
# üîπ Heatmap: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡πà‡∏≠ FA
# ------------------------------
st.subheader("üî• ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡πà‡∏≠ FA")
heatmap_data = filtered_df.groupby(["‡∏ä‡∏∑‡πà‡∏≠ FA", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"]).size().unstack(fill_value=0)
fig4 = px.imshow(heatmap_data, text_auto=True, aspect="auto", title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ FA")
st.plotly_chart(fig4, use_container_width=True)

# ------------------------------
# üîπ Histogram: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
# ------------------------------
st.subheader("üë• ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ")
fig5 = px.histogram(filtered_df, x="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", nbins=10, title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á")
st.plotly_chart(fig5, use_container_width=True)

# ------------------------------
# üîπ Bar Chart: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î)
# ------------------------------
st.subheader("‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° FA")
risk_summary = filtered_df.groupby("‡∏ä‡∏∑‡πà‡∏≠ FA")["‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î"].sum().reset_index()
fig6 = px.bar(risk_summary, x="‡∏ä‡∏∑‡πà‡∏≠ FA", y="‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î", title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ FA")
st.plotly_chart(fig6, use_container_width=True)

# ------------------------------
# üîπ Data Table
# ------------------------------
st.subheader("üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
st.dataframe(filtered_df[[
    "‡∏ä‡∏∑‡πà‡∏≠ FA", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", "‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á/‡∏û‡πâ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á", "‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏ö‡∏ö", "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"
]])
